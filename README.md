# Business Rating App

A Flask web application that allows users to rate and review businesses organized by sector. Features user authentication, admin panel, and comprehensive rating system.

## Features

- ğŸ¢ **Browse Businesses by Sector** - Organized business directory by industry
- â­ **Rate & Review** - Users can rate businesses (1-5 stars) with optional comments
- ğŸ‘¤ **User Authentication** - Secure registration and login system
- ğŸ” **Admin Panel** - Manage sectors, businesses, and view statistics
- ğŸ“Š **Analytics** - View average ratings and rating counts per business
- ğŸ”„ **Update Ratings** - Users can update their own ratings anytime

## Project Structure

```
â”œâ”€â”€ app.py                 # Flask application with database models & routes
â”œâ”€â”€ requirements.txt       # Python dependencies
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ base.html         # Base template with navigation
â”‚   â”œâ”€â”€ index.html        # Home page
â”‚   â”œâ”€â”€ sector_detail.html # Sector view with businesses
â”‚   â”œâ”€â”€ business_detail.html # Business details & rating form
â”‚   â”œâ”€â”€ login.html        # Login page
â”‚   â”œâ”€â”€ register.html     # Registration page
â”‚   â””â”€â”€ admin_dashboard.html # Admin management panel
â”œâ”€â”€ static/               # Static assets (images, logos)
â””â”€â”€ business_ratings.db   # SQLite database (created on first run)
```

## Current Scope

This app focuses on business ratings and reviews only. Stock-market chatbot endpoints and related UI are not part of the current build.

## Cloud Hosting (Recommended: Render)

This project is configured for Render with managed PostgreSQL via [render.yaml](render.yaml).

### Deploy Steps

1. Push this project to a Git provider (GitHub/GitLab).
2. In Render, choose **New +** â†’ **Blueprint** and select your repo.
3. Render will create:
  - Web service: `business-rating-app`
  - PostgreSQL database: `business-rating-db`
4. After first deploy, open a Render shell for the web service and run:
  ```bash
  flask init-db
  flask seed-db
  ```
5. Register a user in the app, then promote admin:
  ```bash
  flask make-admin <username>
  ```

### Environment Variables

- `SECRET_KEY` (auto-generated by Render blueprint)
- `DATABASE_URL` (auto-wired from the Render PostgreSQL instance)
- `RENDER=true` (automatically set by Render; enables secure production settings)
- Optional shell-free admin bootstrap (for plans without Render Shell):
  - `ADMIN_BOOTSTRAP_USERNAME`
  - `ADMIN_BOOTSTRAP_EMAIL`
  - `ADMIN_BOOTSTRAP_PASSWORD`

### Notes

- Local development still uses SQLite by default.
- In cloud, `DATABASE_URL` is used automatically.
- Production server command is `gunicorn app:app`.
- Production cookies are configured as `HttpOnly` + `SameSite=Lax` and `Secure` in cloud.
- Proxy headers are trusted in production via `ProxyFix` for correct HTTPS/scheme handling.

### Publish Public URL

After successful deploy, your public app URL is available in Render:

1. Open Render â†’ `business-rating-app` service.
2. Copy the URL shown at the top of the service page (`https://<service>.onrender.com`).
3. Share this URL with end users.

Verify before sharing:

- `https://<service>.onrender.com/healthz` returns `{ "status": "ok" }`.
- Login, rating submission, and `/admin` access work as expected.

If Render Shell is unavailable on your plan, set the optional `ADMIN_BOOTSTRAP_*` environment variables and redeploy. The app will auto-create tables on startup and create the admin user once (if it does not already exist).

### Optional: One-Click Deploy Hook

You can trigger a new deploy without opening the dashboard by creating a Render Deploy Hook.

1. In Render: **business-rating-app** â†’ **Settings** â†’ **Deploy Hook** â†’ **Create Deploy Hook**.
2. Copy the generated URL (looks like this):
  ```
  https://api.render.com/deploy/srv-xxxxxxxxxxxx?key=xxxxxxxxxxxxxxxx
  ```
3. Trigger deploy anytime:
  ```bash
  curl -X POST "https://api.render.com/deploy/srv-xxxxxxxxxxxx?key=xxxxxxxxxxxxxxxx"
  ```

Keep this URL private because anyone with it can trigger a deploy.

## Setup

### 1. Create a virtual environment:
```bash
python -m venv venv
.\venv\Scripts\activate
```

### 2. Install dependencies:
```bash
pip install -r requirements.txt
```

### 3. Initialize the database:
```bash
flask init-db
```

### 4. (Optional) Seed with sample data:
```bash
flask seed-db
```

## Running

```bash
python app.py
```

The server will start on `http://localhost:5000`

## Default Routes

- **`/`** â€“ Home page with sectors
- **`/sector/<id>`** â€“ View businesses in a sector
- **`/business/<id>`** â€“ View business details and ratings
- **`/register`** â€“ User registration
- **`/login`** â€“ User login
- **`/logout`** â€“ User logout
- **`/admin`** â€“ Admin dashboard (admin access only)

## API Endpoints

### Business Data
- **GET `/api/businesses`** â€“ List all businesses (optional: `?sector_id=<id>`)
- **GET `/api/ratings/business/<id>`** â€“ Get ratings for a business

### Ratings (Requires Authentication)
- **POST `/api/rate`** â€“ Submit a rating
  ```json
  {
    "business_id": 1,
    "score": 5,
    "comment": "Great service!"
  }
  ```

### Admin (Requires Admin Access)
- **GET `/admin/sectors`** â€“ List all sectors
- **POST `/admin/sectors`** â€“ Create new sector
- **GET `/admin/businesses`** â€“ List all businesses
- **POST `/admin/businesses`** â€“ Create new business
- **DELETE `/admin/business/<id>`** â€“ Delete a business

## Making a User Admin

After registering a user, run:
```bash
flask make-admin <username>
```

## Database Models

### User
- id, username, email, password_hash, is_admin, created_at
- Relations: ratings (one-to-many)

### Sector
- id, name, description, created_at
- Relations: businesses (one-to-many)

### Business
- id, name, description, sector_id, website, location, created_at
- Relations: ratings (one-to-many)

### Rating
- id, score (1-5), comment, user_id, business_id, created_at
- Relations: user, business

## Requirements

Python 3.7 or higher